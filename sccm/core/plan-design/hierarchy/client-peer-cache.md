---
title: "クライアント ピア キャッシュ | System Center Configuration Manager"
description: "System Center Configuration Manager でコンテンツを展開する場合は、クライアントのコンテンツ ソースの場所のピア キャッシュを使用します。"
ms.custom: na
ms.date: 7/3/2017
ms.reviewer: na
ms.suite: na
ms.prod: configuration-manager
ms.technology:
- configmgr-other
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: 86cd5382-8b41-45db-a4f0-16265ae22657
caps.latest.revision: 3
author: Brenduns
ms.author: brenduns
manager: angrobe
ms.translationtype: Human Translation
ms.sourcegitcommit: ed6b65a1a5aabc0970cd0333cb033405cf6d2aea
ms.openlocfilehash: 94802680747a3d371716c1b345b2cba098150716
ms.contentlocale: ja-jp
ms.lasthandoff: 07/03/2017

---

# Configuration Manager クライアントのピア キャッシュ
<a id="peer-cache-for-configuration-manager-clients" class="xliff"></a>

*適用対象: System Center Configuration Manager (Current Branch)*

System Center Configuration Manager バージョン 1610 以降、**ピア キャッシュ**を使用して、コンテンツをリモートの場所にあるクライアントに展開できます。 ピア キャッシュとは、クライアントがローカル キャッシュで他のクライアントとコンテンツを直接共有できるようにするための組み込みの Configuration Manager ソリューションです。   

> [!TIP]  
> バージョン 1610 で導入されたピア キャッシュとクライアント データ ソースのダッシュボードは、プレリリース機能です。 有効にするには、「[更新プログラムからのプレリリース機能の使用](/sccm/core/servers/manage/pre-release-features)」をご覧ください。

## 概要
<a id="overview" class="xliff"></a>
ピア キャッシュ クライアントは、ピア キャッシュの使用が有効にされた構成マネージャー クライアントです。 追加のクライアントと共有できるコンテンツを含むピア キャッシュ クライアントは、ピア キャッシュ ソースです。
 -  クライアント設定を使用してピア キャッシュを使用するクライアントを有効にできます。
 -  ピア キャッシュ ソースとしてコンテンツを共有するには、ピア キャッシュ クライアントは以下である必要があります。
    -  ドメインに参加している必要があります。 ただし、ドメインに参加していないコンテンツは、ドメインに参加しているピア キャッシュ ソースからコンテンツを取得できます。
    -  コンテンツをシークしている、クライアントの現在の境界グループのメンバーである必要があります。 クライアントがフォールバックを使用して近隣の境界グループからコンテンツをシークする場合は、近隣の境界グループのピア クライアントは使用可能なコンテンツ ソースの場所のプールに含まれません。 現在および近隣の境界グループの詳細については、「[境界グループ](/sccm/core/servers/deploy/configure/define-site-boundaries-and-boundary-groups##a-namebkmkboundarygroupsa-boundary-groups)」を参照してください。
 - Configuration Manager クライアントのキャッシュに保持されているコンテンツのすべての種類は、ピア キャッシュを使用して他のクライアントに提供できます。
 -  ピア キャッシュは、BranchCache などのその他のソリューションの使用に取って代わるものではなく、それらのソリューションと並列動作し、配布ポイントなどの従来のコンテンツ展開ソリューションを拡張する追加のオプションを提供します。 これは、BranchCache に依存しないカスタム ソリューションであるため、Windows BranchCache を有効にしない、または使用しない場合でも機能します。

### オペレーション
<a id="operations" class="xliff"></a>

ピア キャッシュを有効にするクライアント設定をコレクションに展開すると、そのコレクションのメンバーは同じ境界グループ内の他のクライアントのピア コンテンツ ソースとして動作できます。
 -  ピア コンテンツ ソースとして動作するクライアントは、キャッシュされている利用可能なコンテンツの一覧を管理ポイントに送信します。
 -  次に、その境界グループ内の次のクライアントがそのコンテンツを要求すると、コンテンツのある各ピア キャッシュ ソースが、その境界グループ内の配布ポイントとその他のコンテンツ ソースの場所とともに潜在的なコンテンツ ソースとして返されます。
 -  通常の運用プロセスごとにコンテンツをシークするクライアントは、提供されたソースのプールからコンテンツ ソースを選択し、そのコンテンツの取得の試みを続行します。

> [!NOTE]
> コンテンツの近隣の境界グループへのフォールバックが発生した場合、近隣の境界グループからのピア キャッシュ コンテンツ ソースの場所は、クライアントの潜在的なコンテンツ ソースの場所のプールに追加されません。  


すべてのクライアントをピア キャッシュ ソースとして参加させることができる場合であっても、ピア キャッシュ ソースに最も適しているクライアントのみを選ぶことをお勧めします。  クライアントのシャーシの種類、ディスク容量、ネットワーク接続などに基づくクライアントの適合性を評価できます。 ピア キャッシュで使用する最適なクライアントを選択するのに役立つ詳細については、[Microsoft のコンサルタントによる、このブログ](https://blogs.technet.microsoft.com/setprice/2016/06/29/pe-peer-cache-custom-reporting-examples/)を参照してください。

**ピア キャッシュ ソースへのアクセス制限**  
バージョン 1702 以降、ピア キャッシュ ソース コンピューターが次のいずれかの条件を満たす場合、ピア キャッシュ ソース コンピューターはコンテンツの要求を拒否するようになります。  
  -  バッテリ低下モードの場合。
  -  コンテンツの要求時に CPU 負荷が 80% を超えている場合。
  -  ディスク I/O の *AvgDiskQueueLength* が 10 を超えている場合。
  -  新たにコンピューターに接続できない場合。   

これらの設定は、System Center Configuration Manager SDK を使うときに、ピア ソース機能 (*SMS_WinPEPeerCacheConfig*) のクライアント構成サーバー WMI クラスを使って構成できます。

コンピューターがコンテンツの要求を拒否すると、要求元のコンピューターは、使うことができるコンテンツ ソース場所のプール内にある代替ソースのコンテンツを引き続きシークします。   



### 監視
<a id="monitoring" class="xliff"></a>   
クライアントが正常にピア キャッシュの使用を把握しやすいように、クライアント データ ソース ダッシュボードを表示できます。 「[Client Data Sources dashboard](/sccm/core/servers/deploy/configure/monitor-content-you-have-distributed#client-data-sources-dashboard)」 (クライアント データ ソースのダッシュボード) を参照してください。

バージョン 1702 以降では、3 つのレポートを使ってピア キャッシュの使用状況を表示できます。 コンソールで、**[監視]** > **[レポート]** > **[レポート]** に移動します。 すべてのレポートの種類は**ソフトウェア配布コンテンツ**です。
1.  **ピア キャッシュ ソース コンテンツの拒否**:  
境界グループ内のピア キャッシュ ソースがコンテンツ要求を拒否した頻度を把握するには、このレポートを使います。
 - **既知の問題:** *MaxCPULoad* や *MaxDiskIO* などの結果にドリルダウンすると、レポートまたは詳細情報が見つからないことを示すエラーが発生する場合があります。 この問題を回避するには、結果を直接表示する次の 2 つのレポートを使ってください。

2. **条件別のピア キャッシュ ソース コンテンツの拒否**:  
指定した境界グループまたは拒否の種類についての拒否の詳細を把握するには、このレポートを使います。 以下を指定できます

  - **既知の問題:** 使用可能なパラメーターから選ぶことができず、代わりに手入力する必要があります。 最初のレポートに表示される*境界グループ名*と*拒否の種類*の値を入力します。 たとえば、*拒否の種類*には、*MaxCPULoad* や *MaxDiskIO* などと入力します。

3. **ピア キャッシュ ソース コンテンツの拒否の詳細**:   
  拒否されたときに要求されていた内容を把握するには、このレポートを使います。

 - **既知の問題:** 使用可能なパラメーターから選ぶことができず、代わりに手入力する必要があります。 最初のレポート (ピア キャッシュ ソース コンテンツの拒否) に表示される*拒否の種類*を入力し、詳細を表示する*リソース ID*を入力します。  コンテンツ ソースのリソース ID を調べるには:  

    1. 2 番目のレポート (条件別のピア キャッシュ ソース コンテンツの拒否) の結果に*ピア キャッシュ ソース*として表示されるコンピューター名を確認します。  
    2. 次に、**[資産とコンプライアンス]** > **[デバイス]** に移動し、そのコンピューター名を検索します。 [リソース ID] 列の値を使います。  


## ピア キャッシュの要件と考慮事項
<a id="requirements-and-considerations-for-peer-cache" class="xliff"></a>
-   ピア キャッシュは、Configuration Manager クライアントとしてサポートされているすべての Windows OS でサポートされています。 Windows 以外のオペレーティング システムは、ピア キャッシュではサポートされていません。

-   クライアントは、現在の境界グループ内にあるピア キャッシュ クライアントのコンテンツのみを転送できます。

-   クライアントがピア キャッシュを使用する各サイトは、[ネットワーク アクセス アカウント](/sccm/core/plan-design/hierarchy/manage-accounts-to-access-content#a-namebkmknaaa-network-access-account)を使用して構成する必要があります。 アカウントは、ピア キャッシュ ソース コンピューターによって、ピアからのダウンロード要求を認証するために使用され、この目的にはドメイン ユーザーのアクセス許可のみが必要です。

-   ピア キャッシュ コンテンツ ソースの現在の境界は、そのクライアントの最後のハードウェア インベントリ送信によって決定されるため、ネットワークの場所に移動し別の境界グループ内にあるクライアントは、ピア キャッシュを目的として、その以前の境界グループのメンバーであると見なされる場合があります。 これにより、クライアントが、直接のネットワークの場所にない、ピア キャッシュ コンテンツ ソースが提供されます。 この構成の傾向のあるクライアントをピア キャッシュ ソースとして参加させないようにすることをお勧めします。

## クライアント ピア キャッシュのクライアント設定を構成するには
<a id="to-configure-client-peer-cache-client-settings" class="xliff"></a>
1.  Configuration Manager コンソールで **[管理]** > **[クライアント設定]** に移動し、使用するデバイス クライアント設定オブジェクトを開きます。 既定のクライアント設定オブジェクトを変更することもできます。
2.  使用可能な設定のリストから [**クライアント キャッシュ設定**] を選びます。
3.  **[完全な OS 上の Configuration Manager クライアントでコンテンツを共有できるようにする]** を **[はい]** に設定します。
4.  ピア キャッシュに使用するポートを定義するには、次の設定を構成します。  
  -  **初期ネットワーク ブロードキャスト用ポート**
  -  **クライアント ピア通信用に HTTPS を有効にする**
  -  **ピアからのコンテンツのダウンロード用ポート (HTTP/HTTPS)**

ピア キャッシュが有効になっている各コンピューターで Windows ファイアウォールを使用している場合、Configuration Manager はユーザーが構成したポートの使用を許可するようにします。

