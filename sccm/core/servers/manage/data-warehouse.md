---
title: "データ ウェアハウス | Microsoft Docs"
description: "System Center Configuration Manager のデータ ウェアハウス サービス ポイントとデータベース"
ms.custom: na
ms.date: 5/31/2017
ms.prod: configuration-manager
ms.reviewer: na
ms.suite: na
ms.technology:
- configmgr-other
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: aaf43e69-68b4-469a-ad58-9b66deb29057
caps.latest.revision: 
author: Brenduns
ms.author: brenduns
manager: angrobe
ms.translationtype: Human Translation
ms.sourcegitcommit: dc221ddf547c43ab1f25ff83c3c9bb603297ece6
ms.openlocfilehash: f11a53bbc85b40077b3909568db5ae5552b0456c
ms.contentlocale: ja-jp
ms.lasthandoff: 06/01/2017


---
#  System Center Configuration Manager のデータ ウェアハウス サービス ポイント
<a id="the-data-warehouse-service-point-for-system-center-configuration-manager" class="xliff"></a>
*適用対象: System Center Configuration Manager (Current Branch)*

バージョン 1702 以降では、データ ウェアハウス サービス ポイントを使用して、Configuration Manager 展開の長期的な履歴データを格納およびレポートできるようになりました。

> [!TIP]  
> バージョン 1702 で導入されたデータ ウェアハウス サービス ポイントは、プレリリース機能です。 有効にするには、[プレリリース機能の使用](/sccm/core/servers/manage/pre-release-features)に関する記事をご覧ください。

データ ウェアハウスでは、最大 2 TB のデータをサポートし、変更追跡にはタイムスタンプが使用されます。 データの格納は、Configuration Manager サイト データベースからデータ ウェアハウス データベースへの自動化された同期によって達成されます。 この情報には、レポート サービス ポイントからアクセスできます。


同期されるデータには、グローバル データ グループとサイト データ グループからの次のデータが含まれます。
- インフラストラクチャの正常性
- セキュリティ
- コンプライアンス
- マルウェア   
- ソフトウェアの展開
- インベントリの詳細 (ただし、インベントリの履歴は同期されない)

サイト システムの役割のインストール時には、データ ウェアハウス データベースがインストールされて構成されます。 いくつかのレポートもインストールされるため、データを簡単に検索してレポートすることができます。



## データ ウェアハウス サービス ポイントの前提条件
<a id="prerequisites-for-the-data-warehouse-service-point" class="xliff"></a>
- サイト システムのロールをインストールするコンピューターには、.NET Framework 4.5.2 以降が必要です。
- サイト システムの役割をインストールするコンピューターのコンピューター アカウントは、データをデータ ウェアハウス データベースと同期するために使用します。 このアカウントには次の権限が必要です。  
  - データ ウェアハウス データベースをホストするコンピューターの**管理者**。
  - データ ウェアハウス データベースの **DB_owner** へのアクセス許可。
  - 最上位サイトのサイト データベースに対する **DB_reader** および **execute** アクセス許可。
-    データ ウェアハウス データベースは、SQL Server 2012 以降の既定のインスタンス、または名前付きインスタンスでサポートされます。 エディションは Enterprise または Datacenter である必要があります。
  - SQL Server AlwaysOn 可用性グループ: この構成はサポートされていません。
  - SQL Server クラスター: SQL Server フェールオーバー クラスターはサポートされていません。 これは、SQL Server フェールオーバー クラスターでデータ ウェアハウス データベースが完全にテストされていないためです。
  - データ ウェアハウス データベースがサイト サーバー データベースから離れた場所にある場合は、データベースをホストする SQL Server に個別のライセンスが必要です。

> [!IMPORTANT]  
> データ ウェアハウス サービス ポイントを実行しているコンピューターまたはデータ ウェアハウス データベースをホストしているコンピューターが、次のいずれかの言語を実行している場合、データ ウェアハウスはサポートされません。
> - JPN – 日本語
> - KOR – 韓国語
> - CHS - 簡体字中国語
> - CHT – 繁体字中国語 この問題は、今後のリリースで解決される予定です。


## データ ウェアハウスのインストール
<a id="install-the-data-warehouse" class="xliff"></a>
データ ウェアハウスのサイト システムの役割は、階層の最上位層サイト (中央管理サイトまたはスタンドアロン プライマリ サイト) のみにインストールできます。

各階層ではこの役割の単一インスタンスがサポートされ、最上位層サイトのどのサイト システムにも配置することができます。 ウェアハウスのデータベースをホストする SQL Server は、サイト システムの役割に対してローカルまたはリモートに配置できます。 データ ウェアハウスは同じサイトにインストールされているレポート サービス ポイントと連携しますが、この 2 つのサイト システムの役割が同じサーバーにインストールされている必要はありません。   

役割をインストールするには、**[サイト システムの役割の追加ウィザード]** または **[サイト システム サーバーの作成ウィザード]** を使用します。 詳細については、[サイト システムのロールのインストール](/sccm/core/servers/deploy/configure/install-site-system-roles)に関するページを参照してください。  

ロールをインストールすると、指定した SQL Server のインスタンス上にデータ ウェアハウス データベースが Configuration Manager によって作成されます。 既存のデータベース名を指定した場合 ([データ ウェアハウス データベースを新しい SQL Server に移動する場合と同様に](#move-the-data-warehouse-database))、Configuration Manager では、新しいデータベースは作成されず、代わりに指定したデータベースが使用されます。

### インストール時に使用する構成
<a id="configurations-used-during-installation" class="xliff"></a>
**[システムのロールの選択]** ページ:  

**[全般]** ページ:
-     **Configuration Manager データ ウェアハウス データベース接続設定**:
 - **SQL Server の完全修飾ドメイン名**:  
 データ ウェアハウス サービス ポイント データベースをホストするサーバーの完全修飾ドメイン名 (FQDN) を指定します。
 - **SQL Server インスタンス名 (該当する場合)**:   
 SQL Server の既定のインスタンスを使用していない場合は、インスタンスを指定する必要があります。
 - **データベース名**:   
 データ ウェアハウス データベースの名前を指定します。  Configuration Manager はこの名前のデータ ウェアハウス データベースを作成します。 SQL server のインスタンスに既に存在しているデータベース名を指定した場合、Configuration Manager はそのデータベースを使用します。
 - **接続に使用するSQL Server ポート**:   
 データ ウェアハウス データベースをホストする SQL Server 用に構成した TCP/IP ポート番号を指定します。 データ ウェアハウスの同期サービスはこのポートを使用して、データ ウェアハウス データベースに接続します。  

**[同期スケジュール]** ページ:   
- **同期スケジュール**:
 - **開始時刻**:  
 データ ウェアハウスの同期を開始する時刻を指定します。
 - **繰り返しパターン**:
    - **毎日**: 同期が毎日実行されるように指定します。
    - **毎週**: 各週の曜日を 1 つ指定して、同期が毎週繰り返されるようにします。

## レポート
<a id="reporting" class="xliff"></a>
データ ウェアハウス サービス ポイントをインストールすると、同じサイトにインストールされているレポート サービス ポイントでいくつかのレポートが利用できます。 レポート サービス ポイントをインストールする前にデータ ウェアハウス サービス ポイントをインストールした場合は、後でレポート サービス ポイントをインストールしたときにレポートが自動的に追加されます。

データ ウェアハウス サイト システムの役割には、**データ ウェアハウス**のカテゴリを持つ次のレポートが含まれます。
 - **アプリケーションの展開 - 履歴**:   
 特定のアプリケーションとコンピューターについてアプリケーション展開の詳細を表示します。
 - **Endpoint Protection とソフトウェアの更新プログラムの対応 - 履歴**: ソフトウェアの更新プログラムが欠落しているコンピューターを表示します。  
 - **全般的なハードウェアのインベントリ - 履歴**:      
 特定のコンピューターのすべてのハードウェア インベントリを表示します。
 - **全般的なソフトウェアのインベントリ - 履歴**:      
 特定のコンピューターのすべてのソフトウェア インベントリを表示します。
 - **インフラストラクチャの正常性の概要 - 履歴**:     
 Configuration Manager のインフラストラクチャの正常性の概要を表示します。
 - **検出されたマルウェアの一覧 - 履歴**:     
 組織内で検出されたマルウェアを表示します。
 - **ソフトウェア配布の概要 - 履歴**:     
 特定の提供情報を目的とし特定のコンピューターを対象としたソフトウェアの配布の概要。


## 既存のスタンドアロン プライマリを 1 つの階層に展開する
<a id="expand-an-existing-stand-alone-primary-into-a-hierarchy" class="xliff"></a>
中央管理サイトをインストールして既存のスタンドアロン プライマリ サイトを拡張する前に、まずデータ ウェアハウス サービス ポイントの役割をアンインストールする必要があります。 中央管理サイトをインストールした後に、中央管理サイトでサイト システムの役割をインストールすることができます。  

データ ウェアハウス データベースの移動とは異なり、この変更によって以前にプライマリ サイトで同期した履歴データが失われます。 プライマリ サイトからデータベースをバックアップして、中央管理サイトで復元することはサポートされていません。




## データ ウェアハウス データベースの移動
<a id="move-the-data-warehouse-database" class="xliff"></a>
データ ウェアハウス データベースを新しい SQL Server に移動するには、次の手順に従います。

1.    SQL Server Management Studio を使用して、データ ウェアハウス データベースをバックアップします。次に、そのデータベースを、データ ウェアハウスをホストする新しいコンピューター上の SQL Server に復元します。   
> [!NOTE]     
> 新しいサーバーにデータベースを復元したら、新しいデータ ウェアハウス データベースに対するデータベース アクセス許可が、元のデータ ウェアハウス データベースの場合と同じであることを確認します。  

2.    Configuration Manager コンソールを使用して、データ ウェアハウス サービス ポイント サイト システムの役割を現在のサーバーから削除します。
3.    データ ウェアハウス サービス ポイントを再インストールします。さらに、新しい SQL Server の名前と復元したデータ ウェアハウス データベースをホストするインスタンスを指定します。
4.    サイト システムのロールがインストールされたら、移動は完了です。

## データ ウェアハウス問題のトラブルシューティング
<a id="troubleshooting-data-warehouse-issues" class="xliff"></a>
**ログ ファイル**：  
データ ウェアハウス サービス ポイントのインストールまたはデータの同期に関する問題を調査するには、次のログを使用します。
 - *DWSSMSI.log* と *DWSSSetup.log* - データ ウェアハウス サービス ポイントのインストール時に発生したエラーを調査する場合に使用するログです。
 - *Microsoft.ConfigMgrDataWarehouse.log* - サイト データベースとデータ ウェアハウス データベースの間のデータ同期について調査する場合に使用するログです。

**セットアップの失敗**  
 コンピューターにインストールした最初のサイト システムの役割がデータ ウェアハウスのとき、リモート サイト システム サーバーでのデータ ウェアハウス サービス ポイントのインストールが失敗します。  
  - **解決方法**：   
    データ ウェアハウス サービス ポイントをインストールするコンピューターが、少なくとも他に 1 つのサイト システムの役割をホストしていることを確認します。  


**既知の同期の問題**:   
同期に失敗し、*Microsoft.ConfigMgrDataWarehouse.log* に次のエラー メッセージが表示されます。**"failed to populate schema objects (スキーマ オブジェクトの作成に失敗しました)"**  
 - **解決方法**：  
    サイト システムの役割をホストするコンピューターのコンピューター アカウントが、データ ウェアハウス データベースで **db_owner** であることを確認します。

データ ウェアハウス データベースとレポート サービス ポイントが別のサイト システムにあるとき、データ ウェアハウスのレポートを開くことができません。  

 - **解決方法**：  
    **レポート サービス ポイントのアカウント**に、データ ウェアハウス データベースの **db_datareader** アクセス許可を付与します。

データ ウェアハウスのレポートを開くと、次のエラーが返されます。

*レポートの処理中にエラーが発生しました。(rsProcessingAborted) データ ソース 'AutoGen__39B693BB_524B_47DF_9FDB_9000C3118E82_' への接続を作成できません。(rsErrorOpeningConnection) サーバーとの接続を正常に確立しましたが、ログイン前のハンドシェイク中にエラーが発生しました。(プロバイダー: SSL プロバイダー、エラー: 0 - 証明書チェーンが信頼されていない証明機関によって発行されました。)*

- **解決策**: 次の手順に従って、証明書を構成します。

  1. データ ウェアハウス データベースをホストするコンピューターで、

    1. IIS を開き、**[サーバー証明書]** をクリックして、**[自己署名証明書の作成]** を右クリックし、証明書名の "フレンドリ名" を **Data Warehouse SQL Server Identification Certificate (データ ウェアハウス SQL サーバーの識別証明書)** に指定します。 証明書ストアを **[個人]** として選択します。
    2. **[SQL Server Configuration Manager]** を開き、**[SQL Server ネットワークの構成]** で **[MSSQLSERVER のプロトコル]** を右クリックし、**[プロパティ]** を選択します。 次に、**[証明書]** タブで **[Data Warehouse SQL Server Identification Certificate]\(データ ウェアハウス SQL サーバーの識別証明書)** を証明書として選択し、変更を保存します。  
    3. **SQL Server Configuration Manager** を開き、**[SQL Server サービス]** で、**SQL Server サービス**と**レポート サービス**を再起動します。
    4.    Microsoft 管理コンソール (MMC) を開き、**証明書**のスナップインを追加して、ローカル コンピューターの**コンピューター アカウント**の証明書の管理を選択します。 次に、MMC で、**[個人用]** フォルダー > **[証明書]** を展開し、**Data Warehouse SQL Server Identification Certificate (データ ウェアハウス SQL サーバーの識別証明書)** を **DER encoded binary X.509 (.CER)** ファイルとしてエクスポートします。    
  2.    SQL Server Reporting Services をホストするコンピューターで、MMC を開いて**証明書**のスナップインを追加し、**コンピューター アカウント**の証明書の管理を選択します。 **[信頼されたルート証明機関]** フォルダーで、**Data Warehouse SQL Server Identification Certificate (データ ウェアハウス SQL サーバーの識別証明書)** をインポートします。


## データ ウェアハウスのデータフロー
<a id="data-warehouse-dataflow" class="xliff"></a>   
![Datawarehouse_flow](./media/datawarehouse.png)

**データの格納と同期**

| 手順   | 説明  |
|:------:|-----------|  
| **1**  |     サイト サーバーは、サイト データベースにデータを転送して格納します。  |  
| **2**  |      データ ウェアハウス サービス ポイントでは、スケジュールと構成に基づいて、サイト データベースからデータを取得します。  |  
| **3**  |  データ ウェアハウス サービス ポイントでは、同期されたデータのコピーをデータ ウェアハウス データベースに転送して保存します。 |  
**レポート**

| 手順   | 説明  |
|:------:|-----------|  
| **A**  |  組み込みのレポート機能を使用して、ユーザーがデータを要求します。 この要求は SQL Server Reporting Services を使用してレポート サービス ポイントに渡されます。 |  
| **B**  |      レポートの大部分は最新の情報に関するものです、これらの要求は、サイト データベースに対して実行されます。 |  
| **C**  | レポートで履歴データを要求する場合は、*カテゴリ*が**データ ウェアハウス**になっているレポートの 1 つで、データ ウェアハウス データベースに対して要求が実行されます。   |  

