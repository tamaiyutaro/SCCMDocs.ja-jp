---
title: "オペレーティング システムをアップグレードするタスク シーケンスの作成 | Microsoft Docs"
description: "System Center Configuration Manager のタスク シーケンスで、オペレーティング システムを Windows 7 以降から Windows 10 に自動的にアップグレードできます。"
ms.custom: na
ms.date: 10/06/2016
ms.prod: configuration-manager
ms.reviewer: na
ms.suite: na
ms.technology:
- configmgr-osd
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: 7591e386-a9ab-4640-8643-332dce5aa006
caps.latest.revision: 12
author: Dougeby
ms.author: dougeby
manager: angrobe
ms.translationtype: HT
ms.sourcegitcommit: 1035dbbf944a3a467d637a4a948a75b0946eb711
ms.openlocfilehash: 4a3c69edc85a4ea7501510b6b3f12c72ad3a24ff
ms.contentlocale: ja-jp
ms.lasthandoff: 07/11/2017

---
# System Center Configuration Manager のオペレーティング システムをアップグレードするタスク シーケンスを作成する
<a id="create-a-task-sequence-to-upgrade-an-operating-system-in-system-center-configuration-manager" class="xliff"></a>

*適用対象: System Center Configuration Manager (Current Branch)*

System Center Configuration Manager でタスク シーケンスを使用して、対象のコンピューターでオペレーティング システムを Windows 7 以降から Windows 10 に、または Windows Server 2012 以降から Windows Server 2016 に自動的にアップグレードします。 セットアップ先のコンピューターにインストールするオペレーティング システム イメージと、他に追加でインストールするコンテンツ (アプリケーションやソフトウェア更新プログラムなど) を参照するタスク シーケンスを作成します。 オペレーティング システムをアップグレードするタスク シーケンスは、「[Windows を最新バージョンにアップグレードする](upgrade-windows-to-the-latest-version.md)」シナリオの一部です。  

##  <a name="BKMK_UpgradeOS"></a> オペレーティング システムをアップグレードするタスク シーケンスの作成  
 コンピューター上のオペレーティング システムをアップグレードするには、タスク シーケンスを作成し、タスク シーケンスの作成ウィザードで **[オペレーティング システムをアップグレード パッケージからアップグレードする]** を選択します。 ウィザードにより、オペレーティング システムのアップグレード、ソフトウェア更新プログラムの適用、アプリケーションのインストールの各ステップが追加されます。 タスク シーケンスを作成する前に、以下の点を確認しておく必要があります。    

-   **必須**  

     - [オペレーティング システムのアップグレード パッケージ](../get-started/manage-operating-system-upgrade-packages.md) が Configuration Manager コンソールで使用可能である必要があります。
     - Windows Server 2016 にアップグレードする場合は、オペレーティング システムのアップグレードのタスク シーケンスのステップで、**[Ignore any dismissable compatibility messages]\(互換性に関する却下可能なメッセージをすべて無視する\)** の設定を選択しないと、アップグレードに失敗します。

-   **必須 (使用する場合)**  

    -   [ソフトウェア更新プログラム](../../sum/get-started/synchronize-software-updates.md)が Configuration Manager コンソールで同期されている必要があります。  

    -   [アプリケーション](../../apps/deploy-use/create-applications.md)が Configuration Manager コンソールに追加されている必要があります。  

#### オペレーティング システムをアップグレードするタスク シーケンスを作成するには
<a id="to-create-a-task-sequence-that-upgrades-an-operating-system" class="xliff"></a>  

1.  Configuration Manager コンソールで、 **[ソフトウェア ライブラリ]** をクリックします。  

2.  [ **ソフトウェア ライブラリ** ] ワークスペースで [ **オペレーティング システム**] を展開して、[ **タスク シーケンス** ] をクリックします。  

3.  [ **ホーム** ] タブの [ **作成** ] グループで [ **タスク シーケンスの作成** ] をクリックして、タスク シーケンスの作成ウィザードを起動します。  

4.  **[新しいタスク シーケンスの作成]** ページで、 **[オペレーティング システムをアップグレード パッケージからアップグレードする]**をクリックしてから、 **[次へ]**をクリックします。  

5.  [ **タスク シーケンス情報** ] ページで次の設定を指定し、[ **次へ** ] をクリックします。  

    -   **タスク シーケンス名**:タスク シーケンスを識別する名前を指定します。  

    -   **説明**: タスク シーケンスによって実行されるタスクの説明を指定します。  

6.  **[Windows オペレーティング システムのアップグレード]** ページで次の設定を指定し、 **[次へ]**をクリックします。  

    -   **[アップグレード パッケージ]**: オペレーティング システムのアップグレードのソース ファイルを含むアップグレード パッケージを指定します。 **[プロパティ]** ウィンドウの情報を参照して、正しいアップグレード パッケージが選択されていることを確認できます。 詳細については、「[オペレーティング システムのアップグレード パッケージの管理](../get-started/manage-operating-system-upgrade-packages.md)」を参照してください。  

    -   **[エディション インデックス]**: 複数のオペレーティング システムのエディション インデックスをパッケージから入手できる場合、希望のエディション インデックスを選択します。 既定では、最初の項目が選択されています。  

    -   **プロダクト キー**: インストールする Windows オペレーティング システムのプロダクト キーを指定します。 エンコードされたボリューム ライセンス キーと標準のプロダクト キーを指定できます。 エンコードされていないプロダクト キーを使用する場合は、5 文字の各グループをダッシュ (-) で区切る必要があります。 例: *XXXXX-XXXXX-XXXXX-XXXXX-XXXXX* ボリューム ライセンス版のアップグレードの場合は、プロダクト キーは必要ありません。 製品版の Windows のアップグレードの場合のみ、プロダクト キーが必要です。  

    -   **[Ignore any dismissable compatibility messages]\(互換性に関する却下可能なメッセージをすべて無視する\)**: Windows Server 2016 にアップグレードする場合は、この設定を選択します。 この設定を選択しないと、Windows アプリの互換性ダイアログで、ユーザーが **[確認]** をクリックするのを Windows セットアップが待機してしまうため、タスク シーケンスを完了できません。   

7.  **[更新プログラムを含める]** ページで、必要なソフトウェア更新プログラム、すべてのソフトウェア更新プログラム、またはソフトウェア更新プログラムなしを指定してから、 **[次へ]** をクリックします。 ソフトウェア更新プログラムをインストールするように指定する場合、Configuration Manager は、セットアップ先のコンピューターがメンバーとなっているコレクション向けのソフトウェア更新プログラムのみをインストールします。  

8.  **[アプリケーションのインストール]** ページで、展開先コンピューターにインストールするアプリケーションを指定してから、**[次へ]** をクリックします。 複数のアプリケーションを指定する場合は、特定のアプリケーションのインストールに失敗したときにタスク シーケンスを続行するかどうかも指定することができます。  

9. ウィザードを完了します。  



## コンテンツの事前キャッシュを構成する
<a id="configure-pre-cache-content" class="xliff"></a>
バージョン 1702 以降では、タスク シーケンスの利用可能な展開について、事前キャッシュ機能を使うように設定できます。これにより、ユーザーがコンテンツをインストールする前に、関連するコンテンツのみをクライアントにダウンロードさせることができます。
> [!TIP]  
> バージョン 1702 で導入された事前キャッシュは、プレリリース機能です。 有効にするには、「[更新プログラムからのプレリリース機能の使用](/sccm/core/servers/manage/pre-release-features)」をご覧ください。

たとえば、Windows 10 のインプレース アップグレード タスク シーケンスを展開する場合で、すべてのユーザーに対して必要なタスク シーケンスは 1 つのみで、複数のアーキテクチャおよび/または言語に対応する必要があるとします。 1702 より前のバージョンでは、利用可能な展開を作成した場合、その後ユーザーがソフトウェア センターで [**インストール**] をクリックすると、その時点でコンテンツがダウンロードされます。 この場合は、インストールできる状態になるまで、さらに時間がかかります。 また、タスク シーケンスで参照されているすべてのコンテンツがダウンロードされます。 これには、すべての言語およびアーキテクチャ用のオペレーティング システム アップグレード パッケージが含まれます。 それぞれのサイズが約 3 GB だとすると、ダウンロード パッケージは非常に大きなものとなります。

コンテンツの事前キャッシュ機能には、クライアントが展開を受信してすぐに適用可能なコンテンツのみをダウンロードできるようにするオプションが用意されています。 したがって、ユーザーがソフトウェア センターで [**インストール**] をクリックすると、コンテンツはローカルのハード ドライブ上にあるため、コンテンツは準備完了の状態にあり、インストールが迅速に開始されます。

### 事前キャッシュ機能を構成するには
<a id="to-configure-the-pre-cache-feature" class="xliff"></a>

1. 特定のアーキテクチャおよび言語に対応したオペレーティング システム アップグレード パッケージを作成します。 パッケージの [**データ ソース**] タブでアーキテクチャと言語を指定します。 言語については、10 進数変換を使用します (たとえば、1033 は英語を表す 10 進数です。これを 16 進数で表すと 0x0409 となります)。 詳細については、「[オペレーティング システムをアップグレードするタスク シーケンスの作成](/sccm/osd/deploy-use/create-a-task-sequence-to-upgrade-an-operating-system)」を参照してください。

    アーキテクチャと言語の値は、次の手順で作成するタスク シーケンス ステップの条件と照合して、オペレーティング システム アップグレード パッケージの事前キャッシュが必要かどうかを判断するために使用されます。
2. さまざまな言語およびアーキテクチャに対して条件付きステップを適用するタスク シーケンスを作成します。 たとえば、英語バージョンの場合は、次のようなステップを作成することが可能です。

    ![事前キャッシュのプロパティ](../media/precacheproperties2.png)

    ![事前キャッシュのオプション](../media/precacheoptions2.png)  

3. タスク シーケンスを展開します。 事前キャッシュの機能については、次のように構成します。
    - [**全般**] タブで、[**このタスク シーケンス用のコンテンツを事前にダウンロードする**] を選択します。
    - [**展開設定**] タブで、[**目的**] を [**利用可能**] にしてタスク シーケンスを構成します。 **必須**の展開を作成する場合、事前キャッシュ機能は動作しません。
    - [**スケジュール**] タブの [**この展開が使用可能になる日時を指定する**] 設定では、将来の適切な時刻を選択します。これにより、展開をユーザーが利用できるようにする前に、コンテンツを事前キャッシュするのに十分な時間をクライアントに与えます。 たとえば、利用可能時間を 3 時間先に設定することで、コンテンツを事前キャッシュするのに十分な時間を確保することができます。  
    - [**配布ポイント**] タブで、[**展開オプション**] 設定を構成します。 ユーザーがインストールを開始する前にコンテンツを事前キャッシュしない場合は、これらの設定を使用します。


### ユーザー側の表示と操作
<a id="user-experience" class="xliff"></a>
- クライアントは、展開ポリシーを受け取ると、コンテンツの事前キャッシュを開始します。 これには、参照されるすべてのコンテンツ (他のパッケージの種類) と、オペレーティング システム アップグレード パッケージのうち、タスク シーケンスで設定した条件に基づいてクライアントと一致したものが含まれます。
- ユーザーが展開を利用可能になると (展開の [**スケジュール**] タブの設定)、新しい展開に関する情報をユーザーに提供する通知が表示され、展開がソフトウェア センターで確認可能な状態になります。 ユーザーはソフトウェア センターに移動し、[**インストール**] をクリックしてインストールを開始します。
- コンテンツが完全に事前キャッシュされていない場合は、展開の [**展開オプション**] タブで指定した設定が使用されます。 展開を作成した時間と、展開をクライアントが利用できるようにする時間との間隔を適切な長さに設定して、コンテンツを事前キャッシュするのに十分な時間をクライアントに与えることをお勧めします。



## パッケージ コンテンツのダウンロードのタスク シーケンスのステップ
<a id="download-package-content-task-sequence-step" class="xliff"></a>  
 以下のシナリオでは、**オペレーティング システムのアップグレード**のステップの前に、[パッケージ コンテンツのダウンロード](../understand/task-sequence-steps.md#BKMK_DownloadPackageContent)のステップを使用できます。  

-   X86 と x64 の両方のプラットフォームで動作する 1 つのアップグレード タスク シーケンスを使用します。 これを行うには、クライアント アーキテクチャを検出して、該当するオペレーティング システム アップグレード パッケージのみをダウンロードする条件を含む **[アップグレードの準備]** グループに、2 つの **[パッケージ コンテンツのダウンロード]** ステップを追加します。 同じ変数を使用するようにそれぞれの **[パッケージ コンテンツのダウンロード]** ステップを構成して、 **[オペレーティング システムのアップグレード]** ステップ上のメディア パスにその変数を使用します。  

-   該当するドライバー パッケージを動的にダウンロードするには、ドライバー パッケージごとに適切なハードウェアの種類を検出する条件を含む 2 つの **[パッケージ コンテンツのダウンロード]** ステップを使用します。 同じ変数を使用するようにそれぞれの **[パッケージ コンテンツのダウンロード]** ステップを構成し、 **[オペレーティング システムのアップグレード]** ステップのドライバー セクションの **[ステージング済みコンテンツ]** 値に変数を使用します。  

   > [!NOTE]
   > 複数のパッケージがある場合は、Configuration Manager によって、数字のサフィックスが変数名に追加されます。 たとえば、%mycontent% という変数をカスタム変数として指定した場合に、この変数名は、参照コンテンツがすべて格納されているルートになります (複数のパッケージを指定できます)。 これは、オペレーティング システムのアップグレードなどのサブシーケンス ステップで変数を参照するときに、数字のサフィックスと共に使用されます。 この例では、%mycontent01% または %mycontent02% のようになります。各変数の数字は、このステップのパッケージの表示順序に対応しています。

## オプションの後処理のタスク シーケンスのステップ
<a id="optional-post-processing-task-sequence-steps" class="xliff"></a>  
 タスク シーケンスが作成されたら、互換性の問題があることがわかっているアプリケーションをアンインストールするステップを追加するか、コンピューターが再起動して Windows 10 へのアップグレードが成功した後に実行する後処理操作を追加することができます。 これらの追加ステップを、後処理のタスク シーケンスのグループに追加します。  

> [!NOTE]  
>  このタスク シーケンスは線形ではないため、クライアント コンピューターを正常にアップグレードできるかどうかや、クライアント コンピューターを起動時のオペレーティング システムのバージョンにロールバックする必要があるかどうかに応じて、ステップには条件が課され、それらはタスク シーケンスの結果に影響を与える可能性があります。  

## オプションのロールバックのタスク シーケンスのステップ
<a id="optional-rollback-task-sequence-steps" class="xliff"></a>  
 コンピューターの再起動後にアップグレード プロセスで問題が生じると、セットアップはアップグレードを前のオペレーティング システムにロールバックし、タスク シーケンスはロールバック グループのステップを続行します。 タスク シーケンスの作成後、ロールバック グループにオプションのステップを追加することができます。  

## コンピューターの再起動後に削除されるフォルダーとファイル
<a id="folder-and-files-removed-after-computer-restart" class="xliff"></a>  
 オペレーティング システムを Windows 10 にアップグレードするタスク シーケンスとタスク シーケンス内の他のすべてのステップが完了すると、後処理およびロールバックのスクリプトはコンピューターを再起動するまで削除されません。  これらのスクリプト ファイルには、機密情報は含めないでください。  

